{"filter":false,"title":"main.py","tooltip":"/api/main.py","undoManager":{"mark":1,"position":1,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":21}},"text":"#!/usr/bin/env python"},{"action":"insertText","range":{"start":{"row":0,"column":21},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":91,"column":0}},"lines":["# -*- coding: utf-8 -*-","#","# Copyright 2007 Google Inc.","#","# Licensed under the Apache License, Version 2.0 (the \"License\");","# you may not use this file except in compliance with the License.","# You may obtain a copy of the License at","#","#     http://www.apache.org/licenses/LICENSE-2.0","#","# Unless required by applicable law or agreed to in writing, software","# distributed under the License is distributed on an \"AS IS\" BASIS,","# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","# See the License for the specific language governing permmissions and","# limitations under the License.","#","import sys","sys.path.insert(0, 'libs')","import webapp2","from bs4 import BeautifulSoup, UnicodeDammit","import urllib2,re, datetime, cgi","from webapp2_extras import json","","","def getTodaysMenu(location):","    ","    #Generate Regular Expression for Today","    today = datetime.date.today()","    regex = re.compile(str(today.year) + \".*?\" + str(today.month) + \".*?\" + str(today.day));","","    #Get HTML","    if location == \"ulsan\":","        baseURL = 'http://massmail.sk.com/menu/print.aspx?rcode=no2'","    else:","        baseURL = 'http://massmail.sk.com/menu/print.aspx?rcode=no1'","","    html = urllib2.urlopen(baseURL).read()","","    #Parse HTML using BeautifulSoup","    html = BeautifulSoup(html)","","    #Find Today's row","    cell = html.find(text=regex)","","    today_row = cell.parent.parent","    cells = today_row.find_all(\"td\")","","    b_menu_str = \"\"","    l_menu_str = \"\"","    d_menu_str = \"\"","","    #Get Breakfast","    breakfast =  cells[0]","    b_menus = breakfast.find_all(\"li\")","    for item in b_menus:","        b_menu_str += item.get_text() + \"</br>\"","","    #Get Lunch","    lunch =  cells[1]","    l_menus = lunch.find_all(\"li\")","    for item in l_menus:","        l_menu_str += item.get_text() + \"</br>\"","","    #Get Dinner","    dinner = cells[2]","    d_menus = dinner.find_all(\"li\")","    for item in d_menus:","        d_menu_str += item.get_text() + \"</br>\"","","    #Generate JSON","    json_str = \"{'date' : '%s','breakfast' : '%s','lunch': '%s','dinner': '%s'}\" % (today, b_menu_str, l_menu_str, d_menu_str,)","","    return json_str","","","class HQMenuHandler(webapp2.RequestHandler):","    def get(self):","        self.response.content_type = \"application/json\"","        self.response.write(self.request.get(\"callback\") + \"(\"+getTodaysMenu(\"hq\") + \");\")","","class UlsanMenuHandler(webapp2.RequestHandler):","    def get(self):","        self.response.content_type = \"application/json\"","        self.response.write(self.request.get(\"callback\") + \"(\"+getTodaysMenu(\"ulsan\") + \");\")","","app = webapp2.WSGIApplication([","    ('/', HQMenuHandler),","    ('/hq', HQMenuHandler),","    ('/ulsan', UlsanMenuHandler)","], debug=True)"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":16,"column":0},"end":{"row":16,"column":1}},"text":"#"},{"action":"removeLines","range":{"start":{"row":2,"column":0},"end":{"row":16,"column":0}},"nl":"\n","lines":["#","# Copyright 2007 Google Inc.","#","# Licensed under the Apache License, Version 2.0 (the \"License\");","# you may not use this file except in compliance with the License.","# You may obtain a copy of the License at","#","#     http://www.apache.org/licenses/LICENSE-2.0","#","# Unless required by applicable law or agreed to in writing, software","# distributed under the License is distributed on an \"AS IS\" BASIS,","# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","# See the License for the specific language governing permmissions and","# limitations under the License."]}]}]]},"ace":{"folds":[],"scrolltop":719,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":77,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1406683401419,"hash":"4eee32247b6fe7f3cf170eacb347e54dc3fa3d25"}